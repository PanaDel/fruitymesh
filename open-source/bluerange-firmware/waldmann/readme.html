<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>General :: Fruitymesh</title>
    <link rel="canonical" href="https://www.bluerange.io/docs/opensource/bluerange-firmware/waldmann/readme.html">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.bluerange.io/docs/opensource">Fruitymesh</a>
    </div>

    <div class="navbar-end">
      <div class="link navbar-item" id="header-github-logo">
        <a class="link navbar-item" href="https://github.com/mwaylabs/fruitymesh" target="_blank"></a>
      </div>
      <div class="navbar-item">
        <input id="search-input" type="text" placeholder="Search docs">
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="bluerange-firmware" data-version="master">
  <aside class="navigation" role="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title">
      <a href="../index.html">bluerange-firmware</a>
    </h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../Quick-Start.html">Quick Start</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../Usage.html">Usage</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../Features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../Developers.html">Developers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../Specification.html">Specification</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../Modules.html">Modules</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../AdvertisingModule.html">AdvertisingModule</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../DebugModule.html">DebugModule</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../DfuModule.html">DfuModule</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../EnrollmentModule.html">EnrollmentModule</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../IoModule.html">IoModule</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../MeshAccessModule.html">MeshAccessModule</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Node.html">Node</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ScanningModule.html">ScanningModule</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../StatusReporterModule.html">StatusReporterModule</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Other Classes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Logger.html">Logger</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../RecordStorage.html">RecordStorage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Other</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Class-Structure.html">Class Structure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Debugging.html">Debugging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Battery-Consumption.html">Battery Consumption</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../RecordStorage.html">RecordStorage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../The-FruityMesh-Algorithm.html">The FruityMesh Algorithm</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../The-Algorithm-in-Detail.html">In Detail</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Simulator.html">Simulator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../Tutorials.html">Tutorials</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Implementing-a-Custom-Module.html">Implementing a Custom Module</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../FAQ.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">bluerange-firmware</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">bluerange-firmware</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main" role="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="crumbs" role="navigation" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../index.html">bluerange-firmware</a></li>
    <li class="crumb"><a href="readme.html">General</a></li>
  </ul>
</nav>
</div>
<article class="doc">
<h1>General</h1>
<div class="sect1">
<h2 id="_development"><a class="anchor" href="#_development"></a>Development</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When sending code to waldmann, refer to <a href="#">../mway/Generate-Distributions.adoc</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_featuresets"><a class="anchor" href="#_featuresets"></a>Featuresets</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dev_wm_nrf52840</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Development build for waldmann including logging and everything else.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_setup"><a class="anchor" href="#_setup"></a>Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="_images/img/devboard.jpg" alt="devboard"></span></p>
</div>
<div class="paragraph">
<p>Connecting the devboard to USB via its USB/UART connector (1) will power the board. Connecting it via the multiple Jlink adaptors (2) allows us to flash the nRF52840 chip.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1: USB / Serial adapter and board power</p>
</li>
<li>
<p>2: Segger Jlink Connection</p>
</li>
<li>
<p>3: MicroSd card reader for firmware updates</p>
</li>
<li>
<p>4: BLE module with button and rotary encorders</p>
</li>
<li>
<p>5: Waldmann host controller ATSAMD51N19A on <strong>main board</strong> (BLE module can also be plugged in here</p>
</li>
<li>
<p>6: Multiple serial sockets</p>
</li>
<li>
<p>7: Development PCB with some buttons and connectors</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of the module sockets (black) or the serial cable sockets (white) on the main board (5) are connected to the host controller and have a specific (src/dst) id. The host controller will do routing between these ids.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_updating_the_waldmann_controller"><a class="anchor" href="#_updating_the_waldmann_controller"></a>Updating the Waldmann Controller</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Waldmann controller does not need to be flashed, but will be updated using the microSd card reader. When using the button firmware update, the update will be done each time, downgrade and the same version will work as well.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Put the microSd in a PC card reader</p>
</li>
<li>
<p>Copy the firmware update to &lt;sdCard&gt;\WA\IMAGE (E.g. the file is V00_01_s.bin)</p>
</li>
<li>
<p>Unplug the serial adapter (1)</p>
</li>
<li>
<p>Put the microSd card into the card reader (3)</p>
</li>
<li>
<p>hold down the blue button on the host controller PCB (5) and plug in the serial adapter, then let go of the blue button after a second.</p>
</li>
<li>
<p>The LED on the host controller board should be on and stay on for about 15 to 20 seconds. Afterwards, it will go off.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensor_messages"><a class="anchor" href="#_sensor_messages"></a>Sensor Messages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For Waldmann the profileId is used as the register and the nodeAddress (e.g. 0x00 for the main controller) is used to address the attached device that should react on this profile. The actionType is currently unused as the profiles do not have a direction distinction.</p>
</div>
<div class="paragraph">
<p>The following message can be used to switch an LED off:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Javascript hljs" data-lang="Javascript">rltn-iot/ORGANIZATION_UUID/SITE_UUID/BLENODE_UUID/rwio/WM_MODULE/0-4194/write

{
	"register":4194,
	"data":"AAA=",
	"length":2,
	"module":"WM_MODULE",
	"component":0,
	"timestamp":12345
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_component_updates"><a class="anchor" href="#_component_updates"></a>Component Updates</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_test_commands"><a class="anchor" href="#_test_commands"></a>Test Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Below are some helpful commands for testing</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//Activate LED
55 02 00 10 62 00 20 10 00 20 14 3B 6E

//Ack for activate LED
55 01 00 00 A1 10 00 00 20 00 88 D2

//Tunnel message
55 05 00 90 62 00 20 10 00 00 00 00 00 77 89 41

//Sending tunnel data via terminal
raw_data_light 0 155 0 62:90:20:00:00:10:77

//Fake LED message for testing led off
55 02 00 10 62 00 20 10 00 00 00 6F 3D

//Fake LED message for testing led on
55 02 00 10 62 00 20 10 00 01 00 5C 0C

//For reference
component_act [nodeId] [moduleId] [actionType] [component] [registerAddress] [dataHex]

//Switch the LED of the host on
component_act 0 155 0 0x00 0x1062 02:14

//Switch the LED of the host off
component_act 0 155 0 0x00 0x1062 00:00

//Reset the host (no ack)
component_act 0 155 0 0x00 0x74 00</code></pre>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>Build with Antora</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script>antoraLunr.init("../../_/../search_index.json")</script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>

  </body>
</html>
