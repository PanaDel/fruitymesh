<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Dfu Module (ID 4) | BlueRange Firmware</title>
    <link rel="canonical" href="http://localhost:5000/bluerange-firmware/commercial/DfuModule.html">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="schema.dcterms" href="https://purl.org/dc/terms/">
    <meta name="dcterms.subject" content="bluerange-firmware">
    <meta name="dcterms.identifier" content="master">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" id="topbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://www.couchbase.com"><img src="../../_/img/logo.svg" alt="Couchbase"></a>
        <button class="navbar-burger" data-target="topbar-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="topbar-menu" class="navbar-menu">
        <div class="navbar-start">
          <div class="navbar-item has-dropdown">
            <a class="navbar-link" href="http://localhost:5000">Docs</a>
            <div class="navbar-dropdown explore">
              <div class="title">Couchbase Documentation Overview</div>
              <div class="cols">
                <ul>
                  <li class="heading"><a href="#">Server</a></li>
                  <li><a href="../../server//n1ql/n1ql-language-reference/index.html">N1QL</a></li>
                  <li><a href="../../server//fts/full-text-intro.html">Full Text Search</a></li>
                  <li><a href="../../server//analytics/introduction.html">Analytics</a></li>
                  <li><a href="../../server//eventing/eventing-overview.html">Eventing</a></li>
                  <li><a href="#">Autonomous Operator</a></li>
                </ul>
                <ul>
                  <li class="heading">Mobile</li>
                  <li><a href="#">Lite</a></li>
                  <li><a href="#">Sync Gateway</a></li>
                </ul>
                <ul class="two-cols">
                  <li class="heading"><a href="../../server//sdk/overview.html">SDKs</a></li>
                  <li><a href="#">C</a></li>
                  <li><a href="#">.NET</a></li>
                  <li><a href="#">Go</a></li>
                  <li><a href="#">Java</a></li>
                  <li><a href="#">Node.js</a></li>
                  <li><a href="#">PHP</a></li>
                  <li><a href="#">Python</a></li>
                  <li><a href="#">Scala</a></li>
                </ul>
                <ul>
                  <li class="heading"><a href="../../server//connectors/intro.html">Connectors</a></li>
                  <li><a href="#">Elasticsearch</a></li>
                  <li><a href="../../server//connectors/hadoop-1.2/hadoop.html">Hadoop</a></li>
                  <li><a href="#">Kafka</a></li>
                  <li><a href="#">Spark</a></li>
                  <li><a href="#">Talend</a></li>
                  <li><a href="../../server//connectors/odbc-jdbc-drivers.html">ODBC/JDBC</a></li>
                </ul>
              </div>
            </div>
          </div>
          <a class="navbar-item component" href="index.html"><span class="title">BlueRange Firmware</span></a>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <a class="btn red-btn" href="https://www.couchbase.com/downloads">Downloads</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body container">
<nav class="nav">
<div class="nav-menu">
<ul class="nav-list">
  <li class="nav-item is-active" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="AssetModule.html">AssetModule</a>
    </span>
  </li>
  <li class="nav-item is-current-page is-active" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="DfuModule.html">DFU Module</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="Sensors.html">Sensors</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <span class="nav-text">include::fruitymesh:ROOT:page$Quick-Start.adoc[INCLUD LINK page$]</span>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/Quick-Start.html">XREF LInk page$</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/Quick-Start.html">Quick Start</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/Usage.html">Usage</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/Features.html">Features</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/Developers.html">Developers</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/Specification.html">Specification</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../fruitymesh/Modules.html">Modules</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/AdvertisingModule.html">Advertising Module</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/DebugModule.html">Debug Module</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/DfuModule.html">DFU Module</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/EnrollmentModule.html">Enrollment Module</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/IoModule.html">IO Module</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/MeshAccessModule.html">Mesh Access Module</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/Node.html">Node</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/ScanningModule.html">Scanning Module</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/StatusReporterModule.html">Status Report Module</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Other Classes</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/Logger.html">Logger</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/RecordStorage.html">Record Storage</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Other</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/Class-Structure.html">Class Structure</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/Debugging.html">Debugging</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/Battery-Consumption.html">Baterry Consumption</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/RecordStorage.html">Record Storage</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../fruitymesh/The-FruityMesh-Algorithm.html">The Fruitymesh Algorithm</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/The-Algorithm-in-Detail.html">The Algorithm in Detail</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/Simulator.html">Simulator</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../fruitymesh/Tutorials.html">Tutorials</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/Implementing-a-Custom-Module.html">Implementing a Costom Module</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../fruitymesh/FAQ.html">FAQ</a>
    </span>
  </li>
</ul>
  </li>
</ul>
</div>
</nav>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
<main class="article" data-ceiling="topbar">
  <div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">BlueRange Firmware</a></li>
    <li class="crumb"><a href="DfuModule.html">DFU Module</a></li>
  </ul>
</nav>
<div class="tools" role="navigation">
  <ul>
    <li class="tool edit"><a href="file:///Users/p.manoloudis/Documents/Antora/gitlab-fruitymesh/fruitymesh/docs-commercial/modules/commercial/pages/DfuModule.adoc" title="Edit Page" target="_blank" rel="noopener">Edit</a></li>
  </ul>
</div>
  </div>
<article class="doc">
<h1 class="page">Dfu Module (ID 4)</h1>
<div class="sect1">
<h2 id="_purpose"><a class="anchor" href="#_purpose"></a>Purpose</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Mesh DFU provides functionality for updating softdevice, bootloader
and the app on fruitymesh chips and also updating third party components
that are attached to the controller via some bus using specially
implemented commands. In case there are multiple updates to be applied
sequentially, this is called an update sequence.</p>
</div>
<div class="paragraph">
<p>For an overview of the whole platform DFU sequence, see DFU Overview.
For more information about the memory layout, see DFU &amp; Memory Layout.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_errorcode_handling"><a class="anchor" href="#_errorcode_handling"></a>ErrorCode Handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The DFUModule uses a set of different error codes that must be handled
differently depending on the code. Below is a table of all error codes
and how they should be handled. Possible error handling types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ok: No error handling necessary</p>
</li>
<li>
<p>fail: Mark the whole update sequence as failed and also mark the node
as failed with the error code.</p>
</li>
<li>
<p>remove node: Remove the node from the list of nodes to update and mark
it as updated (if possible mark it with: was not updated)</p>
</li>
<li>
<p>fail only node: Mark the node as failed, remove it from the list of
nodes to update and continue</p>
</li>
<li>
<p>retry: Last command must be retried</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_functionality"><a class="anchor" href="#_functionality"></a>Functionality</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_enrolling_over_the_mesh"><a class="anchor" href="#_enrolling_over_the_mesh"></a>Enrolling over the Mesh</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_terminal_commands"><a class="anchor" href="#_terminal_commands"></a>Terminal Commands</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_nordic_secure_dfu"><a class="anchor" href="#_nordic_secure_dfu"></a>Nordic Secure DFU</h3>
<div class="paragraph">
<p><code>ndfu [nodeId]</code></p>
</div>
<div class="paragraph">
<p>The Nordic Secure DFU is the DFU bootloader provided from nRF5 SDK. Detailed description about Nordic Secure DFU can be found in <a href="https://infocenter.nordicsemi.com/index.jsp?topic=%2Fcom.nordic.infocenter.sdk5.v15.0.0%2Fble_sdk_app_dfu_bootloader.html">nordic documentation</a></p>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//start the nordic secure dfu of the node having nodeId 200
ndfu 200</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_start_dfu"><a class="anchor" href="#_start_dfu"></a>Start DFU</h3>
<div class="paragraph">
<p><code>dfu_start [nodeId] [imageType] [numChunks] [chunkSizeExponent] [imageCRC] [firmwareVersion] [requestHandle] [moduleId] [componentId]</code></p>
</div>
<div class="paragraph">
<p>The node will verify all conditions and respond with either error or ok. If all conditions are verified, it will clear enough free space to receive data and respond with ok.</p>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//start the dfu of the device having nodeId 200
dfu_start 200 1 200 6 53856 1540449174 2 0 0</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_start_dfu_ignoring_masterid"><a class="anchor" href="#_start_dfu_ignoring_masterid"></a>Start DFU Ignoring Masterid</h3>
<div class="paragraph">
<p><code>dfu_start_nomaster [nodeId] [imageType] [numChunks] [chunkSizeExponent] [imageCRC] [firmwareVersion] [requestHandle] [moduleId] [componentId]</code></p>
</div>
<div class="paragraph">
<p>The node will respond the same as <code>dfu_start</code> command but in this case the nodeId of dfuMaster will not be saved and compared against the dfu start settings for further packets. Refer to
<a href="#">Messages</a> for more information</p>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//start the nomaster dfu of the device having nodeId 200
dfu_start_nomaster 200 1 200 6 53856 1540449174 2 0 0</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sending_dfu_data"><a class="anchor" href="#_sending_dfu_data"></a>Sending DFU Data</h3>
<div class="paragraph">
<p><code>dfu_data [nodeId] [packetNumber] [data] [dataLength] [crc] [requestHandle]</code></p>
</div>
<div class="paragraph">
<p>Sends a part of the binary image data. If the last chunk was smaller than the chunkSize, the rest of the packet should be padded with 0xFF (empty flash). A direct response to the message is not given but periodically the message of actionType::DFU_STATUS will be sent.</p>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//Sends the dfu data to nodeId 200
dfu_data 200 0 00:00:00:00 4 33984 2</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inquiring_about_dfu"><a class="anchor" href="#_inquiring_about_dfu"></a>Inquiring About DFU</h3>
<div class="paragraph">
<p><code>dfu_all_transmitted [nodeId] [imageSizeInByte] [requestHandle]</code></p>
</div>
<div class="paragraph">
<p>Sends a query to get the status of transmission. It will receive an ok response if the image was fully saved or a request response for missing chunks.</p>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//Inquires from the device having nodeId 200 about the dfu status
dfu_all_transmitted 200 4 2</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_dfu"><a class="anchor" href="#_installing_dfu"></a>Installing DFU</h3>
<div class="paragraph">
<p><code>dfu_apply [nodeId] [waitSeconds] [imageSizeInByte] [requestHandle]</code></p>
</div>
<div class="paragraph">
<p>Instruct the node to install the update and trigger a reboot in case of fruitymesh update.</p>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//Device having nodeId 200 will install the updates and will trigger restart after 5 sec
dfu_apply 200 60000 4 2</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dfu_done_received"><a class="anchor" href="#_dfu_done_received"></a>DFU Done Received</h3>
<div class="paragraph">
<p><code>dfu_done_received [nodeId] [requestHandle]</code></p>
</div>
<div class="paragraph">
<p>Instruct the node to stop sending DFU_DONE messages.</p>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">//Device having nodeId 200 will stop sending DFU_DONE messages
dfu_done 200 2</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_messages"><a class="anchor" href="#_messages"></a>Messages</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_message_types"><a class="anchor" href="#_message_types"></a>Message Types</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">enum DFUModuleTriggerActionMessages
{
    DFU_START = 0, // Sent by the gateway, request for update, will clear some free space if ok to receive data
    DFU_CHUNK = 1, //An actual part of the firmware data according to the cunkSize given in DFU_START
    DFU_REQUEST_CHUNKS = 2, //A packet that is asking for some missing chunks that were not recieved previously
    DFU_ALL_TRANSMITTED = 3, //Sent to query the status of transmission (Response will be all transmitted, or a request for chunks)
    DFU_APPLY = 4, //Request to install the finished update
    RESET_DFU_DONE = 6, //Tell the node to stop sending DFU_DONE messages
    START_NRF_SECURE_DFU = 7, //Only used for nordic secure DFU updates
    DFU_START_IGNORE_MASTERID //Starts the dfu but doesn't save the dfuMasterNodeId (used for updates over meshaccess connections)
};
enum DFUModuleActionResponseMessages
{
    DFU_START_RESPONSE = 0, //Answer if DFU update was started
    DFU_CHUNK_RESPONSE = 1, // Currently unused
    DFU_STATUS = 2, //Status of the DFU update in percent (will be sent periodically (randomly) during a DFU update by the nodes
    DFU_ALL_TRANSMITTED_RESPONSE = 3, //Sent after the image has been checked and is ready (a reboot must trigger the update)
    DFU_DONE = 5 //A periodic message indicating that the dfu was finished, must be stopped using RESET_DFU_DONE
};</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_starting_the_dfu_update"><a class="anchor" href="#_starting_the_dfu_update"></a>Starting The DFU Update</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_request"><a class="anchor" href="#_request"></a>Request</h3>
<div class="paragraph">
<p>actionType: DFU_START or DFU_START_IGNORE_MASTERID</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">enum ImageType{
    IMAGE_TYPE_SOFTDEVICE = 0, //Bluetooth stack of the node
    IMAGE_TYPE_APP = 1, //FruityMesh App
    IMAGE_TYPE_APP_FORCED = 2, //FruityMesh App without version check (do not use)
    IMAGE_TYPE_SD_AND_APP = 3, //Bluetooth Stack + Fruitymesh App
    IMAGE_TYPE_BOOTLOADER = 4, //Fruityloader
    IMAGE_TYPE_COMPONENT = 5 //External controller connected via UART, ....
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>The controller will check if all conditions are met and will either
respond with an error or it will clear enough free space and will
respond with ok. if IGNORE_MASTERID is used, the nodeId of the dfuMaster
will not be saved and compared against the dfu start settings for further
packets. This is used when sending the update over meshaccess
connections as we only have a temporary partnerId at all times and it
might change.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connPacketModule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uses MESSAGE_TYPE_MODULE_TRIGGER_ACTION</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">firmwareVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer with the version of the update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imageType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the update image (ImageType)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunkSizeExponent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chunk Size (2^exp) e.g. 0=1, 1=2, 2=4,&#8230;&#8203;. Should
use 6 by default for 64 byte chunk size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">numChunks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of chunks to
be transmitted for the update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imageCRC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">crc16 of the full image
(CRC-CCITT (0xFFFF)),
<a href="https://www.lammertbies.nl/comm/info/crc-calculation.html">https://www.lammertbies.nl/comm/info/crc-calculation.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">moduleId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Id of the module that needs to be update, see ModuleIds,
e.g. DFU_MODULE_ID=4 for updating the fruitymesh firmware, or
VS_MODULE_ID=151 for updating an external VS Controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">componentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In case that the module communicates with multiple
external controllers, its id can be specified using the componentId</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_response"><a class="anchor" href="#_response"></a>Response</h3>
<div class="paragraph">
<p>actionType: DFU_START_RESPONSE</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connPacketModule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uses MESSAGE_TYPE_MODULE_ACTION_RESPONSE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resultCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of DFU_START_DFU_RESPONSE_CODE_</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If received by a JSON capable device, the dfu_start_response will be printed out like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
	"nodeId": 20,
	"type": "dfu_start_response",
	"module": 4,
	"requestHandle": 0,
	"percent": 20
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Error Code</th>
<th class="tableblock halign-left valign-top">Error Handling</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_START_DFU_RESPONSE_CODE_OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ok</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_START_DFU_RESPONSE_CODE_SAME_VERSION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remove node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_START_DFU_RESPONSE_CODE_RUNNING_NEWER_VERSION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remove node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_START_DFU_RESPONSE_CODE_ALREADY_IN_PROGRESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ok</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_START_DFU_RESPONSE_CODE_NO_BOOTLOADER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_START_DFU_RESPONSE_CODE_FLASH_BUSY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">retry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_START_DFU_RESPONSE_CODE_NOT_ENOUGH_SPACE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_START_DFU_RESPONSE_CODE_CHUNKS_TOO_BIG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail (Could use smaller
chunk size)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_START_DFU_RESPONSE_CODE_MODULE_NOT_AVAILABLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail only node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_START_DFU_RESPONSE_CODE_MODULE_NOT_UPDATABLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail only node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_START_DFU_RESPONSE_CODE_COMPONENT_NOT_UPDATEABLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remove node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_START_DFU_RESPONSE_CODE_MODULE_QUERY_WAITING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(internal error
code, will not be sent)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_START_DFU_RESPONSE_CODE_TOO_MANY_CHUNKS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail (Master can use
bigger chunk size to fix) Added 18.06.2018</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unknown Error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_dfu_data_2"><a class="anchor" href="#_sending_dfu_data_2"></a>Sending DFU Data</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_request_2"><a class="anchor" href="#_request_2"></a>Request</h3>
<div class="paragraph">
<p>actionType: DFU_CHUNK</p>
</div>
<div class="paragraph">
<p>Sends a part of the binary image data. If the last chunk is smaller than
chunkSize, the rest of the packet should be padded with 0xFF (empty
flash).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connPacketModule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uses
MESSAGE_TYPE_MODULE_TRIGGER_ACTION</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">packetNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the number of the
chunk being sent (0 &#8230;&#8203; numChunks)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">crc16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The crc16 of the chunk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary data according to the chunkSize</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_response_2"><a class="anchor" href="#_response_2"></a>Response</h3>
<div class="paragraph">
<p>No direct response is given to the command, but periodically, the
actionType: DFU_STATUS will be sent</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connPacketModule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uses MESSAGE_TYPE_MODULE_ACTION_RESPONSE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">percent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 - 100, percent how many packets were saved correctly</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If received by a JSON capable device, the dfu_status will be printed out like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
	"nodeId": 5,
	"type": "dfu_status",
	"module": 4,
	"requestHandle": 0,
	"percent": 40
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_asking_if_the_update_was_received_successfully"><a class="anchor" href="#_asking_if_the_update_was_received_successfully"></a>Asking if the update was received successfully</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_request_3"><a class="anchor" href="#_request_3"></a>Request</h3>
<div class="paragraph">
<p>actionType: DFU_ALL_TRANSMITTED</p>
</div>
<div class="paragraph">
<p>This will check if the image was fully saved and will either respond
with ok or with a request for more chunks.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">---</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">---</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">---</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connPacketModule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uses MESSAGE_TYPE_MODULE_TRIGGER_ACTION</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imageSizeInByte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of bytes in the image</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If received by a JSON capable device, the all_transmitted_response will be printed out like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
	"nodeId": 5,
	"type": "all_transmitted_response",
	"module": 4,
	"code": 20,
	"requestHandle": 0
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_response_3"><a class="anchor" href="#_response_3"></a>Response</h3>
<div class="paragraph">
<p>actionType: DFU_ALL_TRANSMITTED_RESPONSE</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connPacketModule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uses MESSAGE_TYPE_MODULE_ACTION_RESPONSE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">errorCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of DFU_ALL_TRANSMITTED_RESPONSE_CODE_</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Error</th>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Error Handling</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_START_DFU_RESPONSE_CODE_OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ok</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_ALL_TRANSMITTED_RESPONSE_CODE_NOT_PARTICIPATING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail (if node
should have participated, can retry update)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_ALL_TRANSMITTED_RESPONSE_CODE_IMAGE_CRC_FAIL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail (Can retry
update)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unknown Error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_request_4"><a class="anchor" href="#_request_4"></a>Request</h3>
<div class="paragraph">
<p>actionType: DFU_REQUEST_CHUNKS</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connPacketModule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uses MESSAGE_TYPE_MODULE_TRIGGER_ACTION</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multiple of 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of chunks that should be sent again by the
DFU master. These should be collected from all nodes (might of course
overlap). Afterwards DFU_ALL_TRANSMITTED should be sent again</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If received by a JSON capable device, the request_chunks will be printed out like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
	"nodeId": 5,
	"type": "request_chunks",
	"module": 4,
	"requestHandle": 0,
	"chunks": [2, 4]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installing_the_update"><a class="anchor" href="#_installing_the_update"></a>Installing the Update</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_request_5"><a class="anchor" href="#_request_5"></a>Request</h3>
<div class="paragraph">
<p>actionType: DFU_APPLY</p>
</div>
<div class="paragraph">
<p>To install the update, the following command is used and will trigger a
reboot in case of a fruitymesh update. Will not directly generate a
response</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connPacketModule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uses
MESSAGE_TYPE_MODULE_TRIGGER_ACTION</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">waitSeconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of seconds
to wait until installing the update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imageSizeInBytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The image size
again</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_response_4"><a class="anchor" href="#_response_4"></a>Response</h3>
<div class="paragraph">
<p>actionType: DFU_DONE</p>
</div>
<div class="paragraph">
<p>After an update was completed, the node will periodically send this
packet until it is told to stop.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connPacketModule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uses MESSAGE_TYPE_MODULE_ACTION_RESPONSE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the DFU_DONE_CODE_</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If received by a JSON capable device, the dfu_done will be printed out like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
	"nodeId": 5,
	"type": "dfu_done",
	"module": 4,
	"status": 0,
	"requestHandle": 0
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Error</th>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Error Handling</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_DONE_CODE_OK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ok</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_DONE_CODE_COMPONENT_UPDATE_FAILED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Happens if a component
can not handle the update process correctly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_DONE_CODE_CORRUPT_COMPONENT_IMAGE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Happens after a
component received the data and tells us the image is corrupt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_DONE_CODE_SENT_TO_COMPONENT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">retry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retry sending dfu_apply as
this code is temporary and will resolve as soon as the component was
updated fully.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_DONE_CODE_COMPONENT_UPDATE_FAILED_CUSTOMER_SPECIFIC_1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A
customer specific error code explained in the vendor docs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_DONE_CODE_COMPONENT_UPDATE_FAILED_CUSTOMER_SPECIFIC_2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A
customer specific error code explained in the vendor docs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_DONE_CODE_COMPONENT_UPDATE_FAILED_CUSTOMER_SPECIFIC_3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A
customer specific error code explained in the vendor docs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_DONE_CODE_COMPONENT_UPDATE_FAILED_CUSTOMER_SPECIFIC_4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A
customer specific error code explained in the vendor docs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_DONE_CODE_COMPONENT_UPDATE_FAILED_CUSTOMER_SPECIFIC_5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A
customer specific error code explained in the vendor docs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_DONE_CODE_COMPONENT_UPDATE_FAILED_CUSTOMER_SPECIFIC_6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A
customer specific error code explained in the vendor docs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFU_DONE_CODE_COMPONENT_UPDATE_FAILED_CUSTOMER_SPECIFIC_7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A
customer specific error code explained in the vendor docs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unknown Error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_telling_the_node_to_stop_sending_dfu_done"><a class="anchor" href="#_telling_the_node_to_stop_sending_dfu_done"></a>Telling the node to stop sending DFU_DONE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>actionType: RESET_DFU_DONE</p>
</div>
<div class="paragraph">
<p>In order to stop the node from periodically sending DFU_DONE, this
message is sent</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connPacketModule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uses MESSAGE_TYPE_MODULE_TRIGGER_ACTION</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/logo.svg" alt="Couchbase">
          </a>
        </div>
        <div class="contact">
          <p class="address">3250 Olcott Street
Santa Clara, CA 95054
United States</p>
          <a href="https://www.couchbase.com/contact" class="btn white-btn">Contact Us</a>
          <a class="tel" href="tel:1-650-417-7500">1-650-417-7500</a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Company</span></li>
          <li><a href="https://www.couchbase.com/about">About</a></li>
          <li><a href="https://www.couchbase.com/leadership">Leadership</a></li>
          <li><a href="https://www.couchbase.com/news-and-press-releases">News &amp; Press</a></li>
          <li><a href="https://www.couchbase.com/careers">Careers</a></li>
          <li><a href="https://www.couchbase.com/resources/events">Events</a></li>
          <li><a href="https://www.couchbase.com/contact">Contact Us</a></li>
          <li><a href="https://www.couchbase.com/request-pricing">Pricing</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Support</span></li>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://www.couchbase.com/services">Professional Services</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support Login</a></li>
          <li><a href="https://learn.couchbase.com/store" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Quicklinks</span></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Online Training</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
          <li><a href="https://www.couchbase.com/nosql-resources/why-nosql">Why NoSQL</a></li>
          <li><a href="https://www.couchbase.com/resources/security">Security</a></li>
          <li><a href="https://www.couchbase.com/resources/gdpr">GDPR</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://plus.google.com/+CouchbaseServer" class="icon">
              <svg width="50px" height="50px" viewBox="36.72 225.573 542.326 343.67"><path d="m209.02 363.05v68.732h93.212c-15.065 44.252-37.662 68.732-93.212 68.732-56.492 0-100.74-46.135-100.74-102.63s44.252-102.63 100.74-102.63c30.129 0 48.96 10.357 66.849 25.422 14.123-14.123 13.182-16.006 48.96-49.902-31.071-28.246-71.557-45.194-115.81-45.194-95.096-0.94-172.3 76.266-172.3 171.36s77.206 172.3 172.3 172.3c142.17 0 177.01-124.28 165.71-206.2-33.896-1e-3 -165.71-1e-3 -165.71-1e-3zm310.71 3.766v-59.317h-42.369v59.317h-61.2v42.369h61.2v61.2h42.369v-61.2h59.317v-42.369h-59.317z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2018 COUCHBASE All rights reserved.</span>
      <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
      <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
      <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
      <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
