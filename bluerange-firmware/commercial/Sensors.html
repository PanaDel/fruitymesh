<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensors &amp;amp; Actuators :: Fruitymesh</title>
    <link rel="canonical" href="https://www.bluerange.io/docs/opensource/bluerange-firmware/commercial/Sensors.html">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.bluerange.io/docs/opensource">Fruitymesh</a>
    </div>

    <div class="navbar-end">
      <div class="link navbar-item" id="header-github-logo">
        <a class="link navbar-item" href="https://github.com/mwaylabs/fruitymesh" target="_blank"></a>
      </div>
      <div class="navbar-item">
        <input id="search-input" type="text" placeholder="Search docs">
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="bluerange-firmware" data-version="master">
  <aside class="navigation" role="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title">
      <a href="../index.html">bluerange-firmware</a>
    </h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../Quick-Start.html">Quick Start</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../Usage.html">Usage</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../Features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../Developers.html">Developers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../Specification.html">Specification</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../Modules.html">Modules</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../AdvertisingModule.html">AdvertisingModule</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../DebugModule.html">DebugModule</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../DfuModule.html">DfuModule</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../EnrollmentModule.html">EnrollmentModule</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../IoModule.html">IoModule</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../MeshAccessModule.html">MeshAccessModule</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Node.html">Node</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ScanningModule.html">ScanningModule</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../StatusReporterModule.html">StatusReporterModule</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Other Classes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Logger.html">Logger</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../RecordStorage.html">RecordStorage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Other</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Class-Structure.html">Class Structure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Debugging.html">Debugging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Battery-Consumption.html">Battery Consumption</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../RecordStorage.html">RecordStorage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../The-FruityMesh-Algorithm.html">The FruityMesh Algorithm</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../The-Algorithm-in-Detail.html">In Detail</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Simulator.html">Simulator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../Tutorials.html">Tutorials</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Implementing-a-Custom-Module.html">Implementing a Custom Module</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../FAQ.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">bluerange-firmware</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">bluerange-firmware</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main" role="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="crumbs" role="navigation" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../index.html">bluerange-firmware</a></li>
    <li class="crumb"><a href="Sensors.html">Sensors &amp; Actuators</a></li>
  </ul>
</nav>
</div>
<article class="doc">
<h1>Sensors &amp; Actuators</h1>
<div class="sect1">
<h2 id="_purpose"><a class="anchor" href="#_purpose"></a>Purpose</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Provide a generic way of linking the BlueRange firmware to vendor-specific extensions supporting both the reporting of sensor values and the actioning of actuators. Following is the data format used by the firmware as well as the definitions required for interpretation.</p>
</div>
<div class="paragraph">
<p>The implementation is part of the Node class as this represents a core functionality.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_functionality"><a class="anchor" href="#_functionality"></a>Functionality</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_reporting_of_sensors_and_actual_values"><a class="anchor" href="#_reporting_of_sensors_and_actual_values"></a>Reporting Of Sensors And Actual Values</h3>
<div class="paragraph">
<p>BlueRange IoT devices may support multiple sensors, which could e.g. be positioned on multiple lamp heads. A vendor-specific firmware extension is expected to report measurements periodically to the BlueRange sensor module.</p>
</div>
<div class="paragraph">
<p>Some sensor events may be sent periodically to the BlueRange firmware, e.g. a temperature measurement could be reported every 10 minutes. Other sensor events, such as presence may need to be sent event-based. For event based sensor events it is important to know that there is no guaranteed delivery across the system. This means that a measurement may get lost. To cope with that, the following strategies exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A state that does not need to be reported as soon as it changes should be sent in a fixed interval. E.g. a temperature may be reported every 10 minutes.</p>
</li>
<li>
<p>A state that needs to be reported when it changes should be sent as soon as the change occurs (a threshold might be used) but should also have a fixed interval at which the current value is reported to account for lost messages. E.g. detecting if per person is present under a presence sensor or if the person went away. In case an event was missed, it will be reported with a delay of e.g. 10 Minutes. The fixed interval is chosen based on the use case and the importance of the event.</p>
</li>
<li>
<p>Events (e.g. "Button was pressed") should be reported using an incrementing counter. Thereby, it can be considered as a state (e.g. button was pressed 130 times since node was started).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using these techniques it is possible to calculate the number of messages sent in a system and to balance the load.</p>
</div>
<div class="sect3">
<h4 id="_reporting_of_sensor_measurements"><a class="anchor" href="#_reporting_of_sensor_measurements"></a>Reporting Of Sensor Measurements</h4>
<div class="paragraph">
<p>A tiny bit of glue code added to the beacon firmware receives sensor measurement values in a vendor-specific binary message format. In its simplest implementation the data is not interpreted by this firmware extension. The data is packaged in a low-level message for transport to the gateway over the mesh. Here, a message is formed that is comprised of a device and register number and the original binary message payload.</p>
</div>
<div class="paragraph">
<p>Upon reception, the gateway interprets the binary payload using a sensor definition provided and maintained by the 3rd party vendor. The definition describes interpretation of data and reassembly of values in messages reported via the MQTT broker. For correct interpretation the device and register numbers are matched. For each sensor the definition specifies the expected value of the device and the register, and provides offset and length of the binary data to allow extraction. Also, data type and endianess is given as part of the definition to support the technical interpretation of the raw sensor values.</p>
</div>
<div class="paragraph">
<p>Next, these raw values are scaled by a specified factor. The gateway now filters incoming values such that only changing data are reported. Finally, the up-to-date values are inserted into a sensor data JSON message published by the MQTT broker.</p>
</div>
</div>
<div class="sect3">
<h4 id="_consumption_of_sensor_measurements"><a class="anchor" href="#_consumption_of_sensor_measurements"></a>Consumption Of Sensor Measurements</h4>
<div class="paragraph">
<p>Applications and middleware requiring sensor measurements subscribe to sensor data messages at the MQTT broker. Not all software needs all measurements. Therefore the sensor definition includes sensor type and index. These values are encoded in the message topic for filtering the required measurements.</p>
</div>
<div class="paragraph">
<p>The gateway minimizes broker load by publishing only changes to the data. Newly connecting clients need to explicitly request the last known sensor values. Note that the gateway reports all sensor values automatically in case its broker connection gets lost and restored. This keeps all connected clients up to date at any time.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sensor_measurement_history"><a class="anchor" href="#_sensor_measurement_history"></a>Sensor Measurement History</h4>
<div class="paragraph">
<p>The BlueRange server persists sensor data to be able to provide historic values. For this purpose the server is subscribed at all times. Past data reported by known devices can be queried using the BlueRange REST API.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_actuators_and_reference_values"><a class="anchor" href="#_actuators_and_reference_values"></a>Actuators And Reference Values</h3>
<div class="paragraph">
<p>Devices may support altering reference settings or actioning of actuators. For interaction, data is passed from the outside into the vendor-specific firmware extension. Depending on the actionType, an acknowledgement is generated. The acknowledgement contains the current data of the register as if a read command had been issued.</p>
</div>
<div class="sect3">
<h4 id="_directly_accessing_the_mesh"><a class="anchor" href="#_directly_accessing_the_mesh"></a>Directly Accessing The Mesh</h4>
<div class="paragraph">
<p>For device interaction, software such as configuration apps may set up a mesh access connection to the target device. This link allows sending arbitrary data messages directly to the vendor firmware by wrapping them in BlueRange packets.</p>
</div>
<div class="paragraph">
<p>In this mode of interaction the target device is protected only by the ability of the sender establishing the mesh access link. The BlueRange system does not interpret the messages being sent and therefore can not implement further access restrictions. Also, the sender is responsible of knowing the exact capabilities of the target device such as variations in firmware versions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_middleware_access_via_broker"><a class="anchor" href="#_middleware_access_via_broker"></a>Middleware Access Via Broker</h4>
<div class="paragraph">
<p>Higher level logic for observing and controling multiple devices is implemented in the middleware software. For actioning a device, the software publishes an environment profile act message. The BlueRange system translates the message into a number of data packets, which are sent to the devices. For translation, an environment profile must be installed on the BlueRange server.</p>
</div>
<div class="paragraph">
<p>Typically, installation of the environment profile is done using a vendor-specific administration software that also securely configures the target device. The profile clearly states the actions that can be performed on the target device. It prevents the middleware logic from having to know concrete details of the target devices at byte level such as messaging.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This is currently only implemented for touch4light but should be done in a generic way using policies, same as with the sensors.json.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_firmware_messages"><a class="anchor" href="#_firmware_messages"></a>Firmware Messages</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_message_types"><a class="anchor" href="#_message_types"></a>Message Types</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">#define MESSAGE_TYPE_COMPONENT_ACT 58 //Actor messages
#define MESSAGE_TYPE_COMPONENT_SENSE 59 //Sensor messages</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sensor_values"><a class="anchor" href="#_sensor_values"></a>Sensor Values</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">// Generate a sensor event and send through mesh
// (Only used for debugging)
component_sense [nodeId] [moduleId] [actionType] [component] [registerAddress] [hexString | base64String] {requestHandle=0}

//E.g. broadcast sensor event for module 123 from component 7 and registerAddress 77
component_sense 0 123 0 7 77 AA:BB</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following low-level data structure transports sensor measurement values across the mesh.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">enum actionType {
    UNSPECIFIED = 0, // E.g. Generated by sensor itself
    ERROR_RSP = 1, // Error during READ/WRITE/...
    READ_RSP = 2, // Response following a READ
    WRITE_RSP = 3 // Response following a WRITE_ACK
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connPacketHeader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">header</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">moduleId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The module that generated this value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestHandle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional request handle, otherwise 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">actionType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the above actionTypes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">component</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some number identifying the source of the measurements such as a lamp head (<strong>vendor specific</strong>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">registerAddress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An address used to differentiate data transported such as a hardware register number or a message profile id (<strong>vendor specific</strong>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-..</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">payload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actual binary data that represents a sensor reading or multiple.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The packet header consumes 12 bytes, which allows for 8 bytes of payload in a single packet and should be enough for most sensor values. For bigger payloads, it will be split.</p>
</div>
<div class="paragraph">
<p>The output on a sink will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
	"nodeId": 5,                // sender
	"type": "component_sense",  // discriminator
	"module": 123,              // moduleId
	"requestHandle": 0,
	"actionType" : 0,
	"component" : 7,
	"register" : 77,
    "payload": "abcdeQ=="       // bas64 encoded
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_actor_message"><a class="anchor" href="#_actor_message"></a>Actor message</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">// Instruct device to write data into a register address
component_act [nodeId] [moduleId] [actionType] [component] [registerAddress] [hexString | base64String] {requestHandle=0}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following message is used to transport write or read requests through the mesh.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C++ hljs" data-lang="C++">enum actionType {
    RESERVED = 0, // Unused
    WRITE = 1, // Write without acknowledgement
    READ = 2, // Read a value
    WRITE_ACK = 3 // Write with acknowledgement
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">connPacketHeader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">header</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">moduleId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The module that should act on the message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestHandle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional request handle, otherwise 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">actionType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the above actionTypes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">component</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some number identifying the destination for the action (<strong>vendor specific</strong>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">registerAddress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An address, e.g. hardware register number or a message profile id where the data should be written (<strong>vendor specific</strong>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-..</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">payload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For READ, this must be a singly byte that represents the number of bytes to read. For WRITE and WRITE_ACK, the payload is the bytes that should be written.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>No JSON representation is necessary for the moment as the mesh gateway will not react on act messages.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensor_definition"><a class="anchor" href="#_sensor_definition"></a>Sensor definition</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_example"><a class="anchor" href="#_example"></a>Example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JavaScript hljs" data-lang="JavaScript">{
    "sensorModule": [

        {
            "moduleId":155,
            "component": 1,
            "register": 12,

            "offset": 0,
            "length": 2,

            "type": "brightness",
            "index": 0,
            "dataType": "uint16",
            "endianness": "le",
            "scale": 0.1,

            "min": 0,
            "max": 2000,
            "influenceArea" : 4,
            "showInAnalytics" : true
        }, {
            "moduleId":155,
            "component": 1,
            "register": 12,

            "offset": 2,
            "length": 2,

            "type": "temperature",
            "index": 0,
            "dataType": "int16",
            "endianness": "le",
            "scale": 0.01,

            "min": -50.0,
            "max": 100.0,
            "influenceArea" : 7.2,
            "showInAnalytics" : true
        }

    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above describes the sensor measurements of a brightness in decilux and a temperature in centidegree. The metadata section describes how statistical evaluations can be made with that sensor. It can be shown in a heatmap where min and max will be used to calculate the intensity and the influenceArea is the radius around the device that the heatpoint occupies. More metadata can be added in the future. E.g. an influenceAreaType so that the are is calculated according to other metadata from the device, such as the height. Or maybe translations for different languages.</p>
</div>
<div class="paragraph">
<p>The min / max values are applied on the calculated value, after the scale was multiplied.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If we want multiple lamps to be compatible with each other, we should make sure that our customers use the same types and indizes for the same sensor types. Maybe, we should also add the unit name to the type.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_interpretation"><a class="anchor" href="#_interpretation"></a>Interpretation</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">moduleId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The module that is responsible for handling this data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">component</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies source of measurements, matched against <a href="#Sensor values">[Sensor values]</a> binary message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">registerAddress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address of data, matched against <a href="#Sensor values">[Sensor values]</a> binary message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">offset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Index of first byte relevant in payload data of <a href="#Sensor values">[Sensor values]</a> message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Count of consequtive bytes in payload data of <a href="#Sensor values">[Sensor values]</a> binary message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concrete sensor label, such as presence, copied as is to SensorData JSON message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">index</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies the concrete sensor, such as a lamp head index 1..4, copied as is to SensorData JSON message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dataType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interpreted from extracted byte range, see below</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">endianness</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Of values in extracted byte range: le / be.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating point scale factor multiplied forming sensor value. (Optional, defaults to 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Metadata</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minumum value that the sensor value can have after scaling. (Optional, defaults to minimum range of the scaled datatype)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum value that the sensor value can have after scaling (Optional, defaults to maximum range of the scaled datatype)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">influenceArea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Radius around the device (in meter) that is measured by this sensor. Used for calculating the size of the heatmap datapoint. (Optional, defaults to 10)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">showInAnalytics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies if the value can be shown e.g. in the heatmap. (Optional, defaults to false)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following data types are supported:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Data type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">signed byte of 8 bit length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">signed short of 16 bit length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">signed int of 32 bit length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">signed long of 64 bit length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned byte of 8 bit length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned short of 16 bit length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned int of 32 bit length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">single-precision floating point</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double-precision floating point</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ascii</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero-terminated ASCII string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">utf8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero-terminated UTF-8 string</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Byte order is specified as <code>endianness</code> either as <code>le</code> for little endian or <code>be</code> for big
endian.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mqtt_messages"><a class="anchor" href="#_mqtt_messages"></a>MQTT Messages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Sensor events are published by the MeshGateway using MQTT. Actor events can be triggered by publishing to the broker. For the exact contents, refer to the MQTT specification.		The Sensor events are published by the MeshGateway using MQTT.
=== component_sense
<code><strong>SUBSCRIBE:</strong></code>
<code>rltn-iot/{organizationUuid}/{siteUuid}/{beaconUuid}/sensor/{sensorType}/{sensorIndex}/sensorData</code>
Vendor specific data is processed into a generic format using the sensors.json and then published.
=== component_act
<code><strong>PUBLISH:</strong></code>
<code>rltn-iot/{organizationUuid}/{siteUuid}/{beaconUuid}/rwio/{module}/{componentRegister}/{actionReqType}</code>
The component and registerAddress is vendor specific. A transformation method will be available in the future.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_environment_profile"><a class="anchor" href="#_environment_profile"></a>Environment profile</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The configuration is managed per site using the BlueRange REST API endpoints <code>/relution/api/v1/sites/{siteUuid}/environmentProfiles</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
See the above note for generalizing the environmentProfiles.
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>Build with Antora</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script>antoraLunr.init("../../_/../search_index.json")</script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>

  </body>
</html>
